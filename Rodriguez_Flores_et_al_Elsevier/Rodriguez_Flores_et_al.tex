%% 
%% Copyright 2019-2020 Elsevier Ltd
%% 
%% This file is part of the 'CAS Bundle'.
%% --------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'CAS Bundle' is
%% given in the file `manifest.txt'.
%% 
%% Template article for cas-sc documentclass for 
%% double column output.

%\documentclass[a4paper,fleqn,longmktitle]{cas-sc}
\documentclass[a4paper,fleqn]{cas-sc}

% \usepackage[numbers]{natbib}
\usepackage[authoryear]{natbib}
%\usepackage[authoryear,longnamesfirst]{natbib}
\usepackage[export]{adjustbox}
% line numbers
\usepackage{lineno}
\renewcommand\linenumberfont{\normalfont}
\DeclareMathSymbol{\mh}{\mathord}{operators}{`\-}

\begin{document}
\linenumbers
\let\WriteBookmarks\relax
\def\floatpagepagefraction{1}
\def\textpagefraction{.001}

% Short title
\shorttitle{Implementing adaptive operating policies to achieve economic, and groundwater sustainability goals in agriculture}

% Short author
\shortauthors{Rodríguez-Flores et~al.}

% Main title of the paper
\title [mode = title]{Implementing adaptive operating policies to achieve economic, and groundwater sustainability goals in agriculture using Evolutionary Multi-Objective Direct Policy Search}                      

\author[1]{José M. Rodríguez-Flores}[]
% Corresponding author indication
\cormark[1]
% Email id of the first author
\ead{jrodriguezflores3@ucmerced.edu}
\affiliation[1]{organization={Environmental Systems Program, University of California Merced},
    state={CA},
    country={USA}}
%  Credit authorship
\credit{Conceptualization of this study, Methodology, Software}

% Address/affiliation
% Second author
\author[2]{Rohini S. Gupta}[]
\affiliation[2]{organization={Department of Civil and Environmental Engineering, Cornell University},
    state={NY},
    country={USA}}
    
% Third author
\author[3]{Harrison B. Zeff}[]
\credit{Data curation, Writing - Original draft preparation}
% Address/affiliation
\affiliation[3]{organization={Department of Environmental Sciences and Engineering, University of North Carolina at Chapel Hill},
    state={NC},
    country={US}}
% Fourth author
\author[2]{Patrick M. Reed}[]
\credit{Data curation, Writing - Original draft preparation}
% Fifth author
\author[1]{Josué Medellín-Azuara}[]
\credit{Data curation, Writing - Original draft preparation}

% Corresponding author text
\cortext[cor1]{Corresponding author}

% Here goes the abstract
\begin{abstract}
Increasing irrigation demand has heavily relied on groundwater use, especially in places with highly variable water supplies that are vulnerable to drought. Groundwater management in agriculture is becoming increasingly challenging given the growing effects from overdraft and groundwater depletion worldwide. However, multiple challenges emerge when seeking to develop sustainable groundwater management in irrigated systems, such as trade-offs between the economic revenues from food production and groundwater resources, as well as the broad array of uncertainties in food-water systems. In this study we explore the applicability of Evolutionary Multi-Objective Direct Policy Search (EMODPS) to identify adaptive irrigation policies that water agencies and farmers can implement including operational decisions related to land use and groundwater use controls and a groundwater pumping fee. The EMODPS framework yields state-aware, adaptive policies that respond dynamically as system state conditions change, for example with variable surface water (e.g. shifting management strategies across wet versus dry years). For this study, we focus on the Semitropic Water Storage district located in the San Joaquin Valley, California to provide broader insights relevant to ongoing efforts to improve groundwater sustainability in the state. Our findings demonstrate that the adaptive irrigation policies can achieve a flexible groundwater management in a wide range of uncertain future scenarios while meeting sustainability objectives. Among these decisions pumping restrictions and reductions in inflexible irrigation demands from tree crops are actions that can support dry-year pumping while maximizing groundwater storage recovery during wet years. Policies suggest that an adaptive pumping fee is the most flexible decision to control groundwater pumping and land use. 

\end{abstract}

% Use if graphical abstract is present
% \begin{graphicalabstract}
% \includegraphics{figs/grabs.pdf}
% \end{graphicalabstract}

% Research highlights
\begin{highlights}
\item Research highlights item 1
\item Research highlights item 2
\item Research highlights item 3
\end{highlights}

% Keywords
% Each keyword is seperated by \sep
\begin{keywords}
Groundwater sustainability \sep Irrigation management \sep Bi-level Optimization \sep Multi-objective Optimization \sep Direct Policy Search \sep California \sep 
\end{keywords}


\maketitle

\section{Introduction}\label{sct:1}

As irrigation water demand increases due to increased crop acreage and droughts become more frequent, agricultural regions in the world are relying more on groundwater to make up for surface water losses. In Mediterranean climate regions, such as California, groundwater is the primary water source for buffering drought impacts and food production \citep{malmgren_groundwater_2022,priyan_issues_2021}. Aquifer systems’ dynamics are sensitive to changes in temperature, precipitation, and surface water flows, that can be directly impacted by climate change \citep{cuthbert_global_2019,wu_divergent_2020}. However, one of the largest impacts from climate change are the resulting adaptation driven changes in land use and shifting water demands from human activities \citep{taylor_ground_2013}. Globally, groundwater provides 43 percent of the total irrigation needs \citep{siebert_groundwater_2010}, and its share is expected to increase as surface water scarcity increases \citep{wada_nonsustainable_2012}. In California, the limits in coordinated and regulated groundwater management in irrigation-based agriculture have led to decades of increasing stress and depletion of the state's aquifers \citep{vasco_satellite-based_2019}, affecting dependent ecosystems \citep{bierkens_non-renewable_2019}, limiting its access to shallow water-table reliant communities \citep{pauloo_domestic_2020,perrone_dry_2017}, increasing land subsidence \citep{smith_groundwater_2020}, reducing groundwater storage and storativity \citep{alam_post-drought_2021}, and degradation of water quality \citep{levy_critical_2021}. 

The largest rate of groundwater depletion in California has been observed in the San Joaquin Valley (SJV) \citep{ojha_sustained_2018}. The SJV is the most important agricultural region in the United States by economic value \citep{usda_national_2020}, but also strongly susceptible to drought risk. Most of the region’s snowpack and water supply comes from limited atmospheric-river driven events \citep{espinoza_global_2018}. Increasing temperatures and evapotranspiration linked to a warming climate are expected to further reduce snowpack runoff and surface water supply \citep{fernandez-bou_regional_2021,vahmani_will_2022}. Additionally, human factors such as increasing irrigation demand can exacerbate vulnerabilities to increasingly intense droughts \citep{he_intensification_2017}. Over the past decade, the agricultural sector has been significantly impacted by multi-year droughts \citep{lund_lessons_2018,medellin-azuara_economic_2022}. Groundwater pumping is used as a buffer to reduce the negative impacts to agricultural production from surface water shortages, but increasing pumping and a lack of coordinated management have led to significant declines in groundwater levels and reductions in the regional aquifer's capacity to recover \citep{liu_groundwater_2022}.  Additionally, the SJV has seen a significant expansion of perennial tree crops, mainly almonds, which is the most important commodity by value in the region \citep{usda_national_2020}. Although highly profitable, the expansion of perennial tree crops represents a less flexible water demand and a higher financial risk to water shortages due to high establishment costs \citep{mall_water_2019,qin_flexibility_2019}.   

Given the consequences from overdraft in California, the 2014 Sustainable Groundwater Management Act (SGMA) \citep{dwr_sustainable_2021} was put in place to require critically over-drafted basins to achieve sustainability in terms of balancing their recharge and extraction by 2040. Groundwater Sustainability Agencies (GSAs) are locally formed agencies responsible for developing and enforcing policies to manage water conjunctively to address groundwater sustainability. The state defined guidelines in the Sustainable Management Criteria \citep{dwr_sustainable_2017} that GSAs can use to develop management strategies to achieve sustainable goals, including sustainable groundwater levels. The sustainable criteria define a margin of operational flexibility where the groundwater depth can go above the measurable objective (henceforth referred as the groundwater level requirement) but not above the minimum threshold where undesirable results (e.g., dry wells) may occur (Figure \ref{fig:1}). Within this framework, GSAs can develop flexible groundwater management strategies, allowing pumping during dry years and maximizing groundwater recovery during wet years. Overall, California's food production needs to adapt operational water and land allocation decisions and crop choice to achieve groundwater sustainability goals and be less vulnerable to surface water shortages. 


 \begin{figure}[ht]
    \includegraphics[width=0.5\textwidth,center]{conceptual_sgma_policy.jpg}
    \caption{Conceptual behavior of groundwater depth under sustainable management. Dashed line represents the reference ground surface level, orange line depicts the groundwater level requirement and blue line represents the minimum threshold. Red rectangles depict dry periods when groundwater depth increases.}
    \label{fig:1}
\end{figure}

Multiple challenges that are inherent to coupled food-water systems \citep{polhill_modelling_2016} impact the development of groundwater management policies in the SJV. First, food-water systems are dynamic, where each component can evolve and lead to feed-backs \citep{filatova_regime_2016}. Thus, management decisions need to adapt as the coupled system evolves. Second, water management policies may result in trade-offs between economic and sustainability objectives \citep{mcdermid_minimizing_2021,stone_economic_2022,torhan_tradeoffs_2022,null_pareto_2021}. Lastly, there are intrinsic deep uncertainties \citep{stirling_keep_2010} that need to be considered to implement robust policies, including uncertain surface water supplies and crop prices. There is a growing base of literature focused on assessing management policies and mechanisms for groundwater sustainability in agriculture. Water and land use controls as well as economic instruments are the most common strategies that have been implemented. Examples of these mechanisms are groundwater pumping taxing and pricing  \citep{madani_exogenous_2013,mulligan_assessing_2014,stone_economic_2022,wang_development_2023}, pumping restrictions \citep{young_hydrologic-economic_2021,lan_performance_2021,macewan_hydroeconomic_2017,rodriguez-flores_global_2022,wang_development_2023}, pricing energy \citep{hrozencik_impacts_2022}, groundwater markets or water trading mechanisms \citep{khan_effect_2019,kuwayama_regulation_2013,safari_market-based_2023}, land fallowing \citep{van_schmidt_linkages_2022} and land management \citep{bourque_balancing_2019,li_evaluation_2018,bryant_shaping_2020}, implemented individually or utilized in conjunction \citep{graveline_combining_2020,hrozencik_heterogeneous_2017}. However, most of these studies do not capture the complexity of actually implementing these mechanisms in decision making. For example, they do not take into account intrinsic uncertainties such as annual variability in surface water supplies and the trade-offs between groundwater sustainability objectives and economic revenues. 

Secondly, finding optimal groundwater management policies is a nontrivial task. Most formulations to do so are characterized by non-linearity and non-convexity, and must consider a broad array of objectives that balance trade-offs across groundwater sustainability agencies and farmers (i.e., maximizing economic revenues and minimizing distance to groundwater). Heuristic methods such as  multi-objective evolutionary algorithms (MOEAs) has been demonstrated in their ability to address these complexities and discover high quality approximations of optimal trade-offs among objectives in the Pareto-front \citep{reed_evolutionary_2013}. Thus, the resulting Pareto optimal approximate set of solutions are those where there is not a solution with a better performance of an objective without degrading the performance in the remaining objectives \citep{coello_evolutionary_2007}. Even though heuristic optimization frameworks hold promise for support decision making in agriculture \citep{memmah_metaheuristics_2015}, there are few applications pertaining to larger and more complex inter-connected food-water systems. Prior studies show the applicability of MOEAs in groundwater use controls \citep{afshar_multi-objective_2020,salehi_shafa_multi-objective_2023,habibi_davijani_optimization_2016,mehrabi_assessment_2021,banihabib_development_2019,hesamfar_simulation-based_2023} and this study expands the application of MOEAs to find coordinated optimal land and water use decisions to achieve groundwater sustainability and economic objectives in agriculture.  

As reviewed by \citet{thomann_adaptive_2020}, there is a need for new groundwater management frameworks that are dynamic and adaptively responsive to changes in observed system changes. In this study, we draw on Direct Policy Search (DPS) introduced by \citet{rosenstein_robot_2001} as a parameterization-simulation-optimization formulation where in a control policy is parameterized using non-linear universal functions as neural networks and radial basis functions. In DPS, the parameters of the control policy function are optimized rather than the decisions themselves using a simulation-optimization process to search for optimal operations for a system. The application of DPS to water systems was introduced by \citet{koutsoyiannis_evaluation_2003} in reservoir operations and subsequently extended to Evolutionary Multi-objective Direct Policy Search (EMODPS) formalized by \citet{giuliani_universal_2014}. As reviewed by \citet{giuliani_state---art_2021}, the EMODPS framework has proven capable of discovering optimal dynamic adaptive control policies in a broad array of applications with recent examples in multi-reservoir systems \citep{macian-sorribes_inferring_2019} and complex coupled water-energy systems \citep{gupta_can_2020,doering_diagnosing_2021,hamilton_stream_2022}. Additionally, EMODPS aids in the direct use of simulation models and overcoming the "curse of dimensionality" inherent to other control frameworks as Stochastic Dynamic Programming that have been previously applied in agriculture \citep{taylor_dynamic_1993}. 

In this study, we formulate a 5-objective application of EMODPS where the resulting irrigation control policies utilize state information (e.g., surface water availability, groundwater depth and irrigation demand) to adaptively inform decisions, related to pumping and land use controls as well as pricing pumping, for a given production year at the GSA level. The resultant Pareto approximate set of solutions represent control policies that can improve in their performance in objective by trading off reduced performance in one or more other objectives. The 5-objectives considered in this study include: maximize revenue from food production, minimize distance to groundwater (groundwater depth), maximize minimum economic revenue, minimize maximum groundwater depth change and maximize the number of years the groundwater level is at or bellow the groundwater level requirement. We further test the robustness of the resulting irrigation control policies \citep{groves_robust_2019,lempert_making_2013,kasprzyk_many_2013} by assessing how well they perform for a broader sampling of system state conditions or states of the world (SOWs). Exploratory modeling-based evaluation of systems' robustness is being used across a broad array complex water management application contexts balancing human demand, economic objectives, sustainability and engineered performance \citep{graveline_combining_2020,huskova_screening_2016,miro_adaptive_2021,hadjimichael_defining_2020,shuai_robust_2022,moallemi_exploratory_2020,bertoni_discovering_2019,quinn_exploring_2018,trindade_deeply_2019,shuai_robust_2022}. Building off these examples, we identify robust irrigation control policies that achieve performance goals for groundwater depth and economic revenues at the GSA level. 

A core technical contribution of this study is a novel application of a combined hydro-economic and heuristic methods using a bi-level optimization process where the hydro-economic model agricultural production model with a groundwater depth response function is nested within broader MOEA-based search to find adaptive irrigation management policies to achieve groundwater sustainability. This modeling framework is applied to the Semitropic Water Storage District GSA, which represents a broad set groundwater sustainability agencies in the San Joaquin Valley. The objectives of this study are twofold. First, use EMODPS to identify adaptive strategies that achieve groundwater sustainability and economic goals accounting for the characteristics of the food-water system. Second, assess the performance of the optimal policies within the context of the sustainable groundwater management criteria defined by the state.

\section{Study area}

The study area of this research is the Semitropic Water Storage District (SWSD), located in the SJV and the Kern County groundwater basin (Figure \ref{fig:2}). The SWSD also operates its own Groundwater Sustainability Agency, which  coordinates irrigation operations and water management strategies that can be implemented depending on the water budget of each year. Four possible management instruments are analyzed in this study: (1) a control on groundwater use, (2) a groundwater pumping fee that is implemented by the GSA, (3) total land use control, and (4) a perennial crops planting restriction. Other management strategies such as water market mechanisms and supply-side policies focused on augmenting groundwater storage, as managed aquifer recharge \citep{ulibarri_assessing_2021}, are out of the scope of this study. As has been seen in other regions of the SJV, there has been a significant expansion of almonds and other perennial crops in the SWSD over the past 10 years. Other important commodities in the district include vines, alfalfa, corn, cotton, and cucumbers shown in Figure S1 in the Supplementary Material (SM). 
  

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.6\textwidth,center]{Map_Semitropic.jpg}
    \caption{Semitropic Water Storage District study area located in the California’s San Joaquin Valley.}
    \label{fig:2}
\end{figure}

\subsection{Semitropic GSA Hydro-Economic model}

In coupled food-water systems, Hydro-Economic Models have been used as decision support modeling tools to assess water policy and climate change adaptation decisions \citep{ward_hydroeconomic_2021,harou_hydro-economic_2009}. HEMs are able to abstract stakeholders decisions (e.g., farmers) and hydrologic dynamics, as well as their feedback, by integrating economic models with hydrologic response functions \citep{harou_hydro-economic_2009}. They have played an important role in supporting human and natural systems modeling studies focused on better understanding interdependent economic revenues and aquifer dynamics, as shown by \citet{macewan_hydroeconomic_2017}, \citet{afshar_multi-objective_2020}, \citet{graveline_combining_2020} and \citet{rodriguez-flores_global_2022}. Additionally, HEMs have proven to be flexible in assisting assessments of the performance of water management policies under different climate scenarios across a range of space and time scales \citep{partida_hydro-economic_2023}.

\subsubsection{Economic model}\label{sct:hem}

The SWSD's food production system is modeled using a hydro-economic model \citep{harou_hydro-economic_2009} that represents a yearly net profit maximization at the irrigation district level. With this economic model, we can model land and water (surface and groundwater) allocation decisions for crop production. This model assumes that farmers make production decisions to maximize their net revenues by considering crop prices, surface water availability, price of surface water, price of electricity and water management policies. The mathematical model is based on Positive Mathematical Programming (PMP) formalized by \citet{howitt_calibration_1995}. PMP is a HEM method that uses observed agricultural production behavior to define a constraint non-linear optimization model, used to simulate water allocation for policy analysis assuming profit maximization \citep{graveline_combining_2020,macewan_hydroeconomic_2017,howitt_calibrating_2012,rodriguez-flores_insights_2019}. In this study we implemented a PMP calibration that uses a stochastic data assimilation method to calibrate the economic parameters described by \citet{maneta_stochastic_2014} and \citet{maneta_satellite-driven_2020}. This calibration framework enables the update of the distribution of the calibration parameters every time data becomes available. More details on the calibration process are described in SM 1. 

For the calibration of the model, we use statistical data on prices, costs, water applied and yields for each crop category and water supply by source from 1998 to 2015. After the last year of historical observations was incorporated in the recursive data assimilation process, the final ensemble with 400 samples of the PMP calibration parameters $\theta_{i} = [\mu_{i},\beta_{i,water},\beta_{i,land},\delta_{i},\lambda_{i,land},\lambda_{i,water},\bar{\lambda}_{land}]$ are used in the economic model. Equations 1-7 define the PMP net profit maximization problem for food production within the SWSD that is nested in the MOEA for a Bi-level optimization problem (Section \ref{sct:3.2}).

\begin{align}
\underset{{\substack{x_{i,land,t}\geq0\\x_{i,water,t}\geq0\\wat_{i,w,t}\geq0}}}{max} \sum_{i} \{p_{i,t} & \mu_{i}(\beta_{i,land} x^{\rho_i}_{i,land,t}+\beta_{i,water} x^{\rho_i}_{i,water,t})^{\delta_{i}/\rho_i} - (\omega_{i,land} + \lambda_{i,land} + \bar{\lambda}_{land}) x_{i,land,t} \notag \\[-16]
&  - (\omega_{SW,t}+ \lambda_{i,water} )wat_{i,SW,t} - (\omega_{GW,t}+ \lambda_{i,water} + u^{GWF}_{t})wat_{i,GW,t}\} \label{eq:1}
\end{align}

\textit{subject to}
\begin{gather}
\sum_{i} x_{i,land,t} \leq u^{TL}_{t} \label{eq:2}\\
\underset{i\in{PC}}{\sum} x_{i,land,t}  \leq  u^{PL}_{t} \label{eq:3}\\
\underset{i\in{PC}}{\sum} x_{i,land,t}  \geq \underset{i\in{PC}}{\sum} x_{i,land,{t-1}} * 0.95 \label{eq:4}\\
x_{i,water,t} = wat_{i,SW,t} + wat_{i,GW_t} \label{eq:5}\\
\sum_{i} wat_{i,SW,t} \leq b_{SW,t}   \label{eq:6}\\
\sum_{i} wat_{i,GW,t} \leq u^{GWP}_t \label{eq:7}\\
 x_{i,water,t} \geq \bar{x}_{i,water}*0.98 \label{eq:8}
\end{gather}

Where Equation \ref{eq:1} represents the net revenue maximizing objective function, allocating $x_{land,i}$, total water $x_{water,i}$, surface water $wat_{SW,i}$ and groundwater $wat_{GW,i}$ to each crop i (Figure S1). $p_{i,t}$ is the price per ton of crop $i$. Crop production in the first term of Equation \ref{eq:1} is represented by a Constant Elasticity of Substitution (CES) production function \citep{debertin_agricultural_2012,merel_fully_2010}, with the two inputs, land and water.  $\beta_{i,j=[land,water]}$ are the relative use of land and water. $\rho = (\sigma-1)/\sigma$, where $\sigma$ is the elasticity of substitution between inputs used to produce each crop. For this study we defined $\sigma = 0.17$ following \citet{howitt_calibrating_2012}. The scale parameter $\mu_{i}$ and $\delta_{i}$ are calibrated using the first order conditions of the first step of the PMP calibration process (SM 1). The rest of the parameters used in the linear costs are the calibrated Lagrange multipliers $\lambda_{water},\lambda_{land}$, associated to the observed water and land allocation per crop calibration constraints, respectively. Variable costs are linear and include cost of land ($\omega_{i,land}$) and the unit price of surface water ($\omega_{SW,t}$). In contrast the volumetric cost of groundwater pumping is given by $\omega_{GW,t}$, which is a function of price of electricity ($\omega_{E,t}$), the groundwater depth ($GWD_t$) and other parameters related to the characteristics of the wells (SM 2). Additionally, a per cubic meter $u^{GWF}_{t}$ pumping fee can be implemented on top of the pumping cost.

The PMP net revenue maximization problem is subject to land and water availability as well as the quantitative controls of groundwater and land use that are provided by the adaptive policies (Section \ref{sct:dps}). Equation \ref{eq:2} is a total land restriction where $u^{TL}_{t}$ is the total land use control that can be implemented in a year $t$. Equation \ref{eq:3} is an upper boundary perennial crops restriction $u^{PL}_{t}$ that influences the expansion or reduction of land allocated to perennial crops, where $PC \in$ \{Almonds and Pistachios, Subtropical, Other Deciduous and Vine\}. Maintaining the perennial crops removals to what has been observed historically, we add a perennial removal constraint (Equation \ref{eq:4}) such that no more than 5 percent from the previous year perennial crops land can be allocated to other crops or taken out of production. Equation \ref{eq:5} is a mass balance restriction for each crop water use from both surface water and groundwater. Equation \ref{eq:6} is the surface water availability ($b_{SW,t}$) restriction. Equation \ref{eq:7} is the total groundwater pumping restriction where $u^{GWP}_{t}$ is the maximum allowed groundwater pumping decision. $u^{GWF}_{t}$, $u^{TL}_{t}$, $u^{PL}_{t}$, $u^{GWP}_{t}$ are the four management decision that this study assess formulated in the adaptive control policy (Section \ref{sct:dps}).  Finally, we allow up to 2\% deficit irrigation through Equation \ref{eq:8} which allows reductions in the applied water per  unit of land ($\bar{x}_{i,water}$) with respect to baseline calibration conditions. 

\subsubsection{Groundwater Depth Response Function}

The dynamics of groundwater in the San Joaquin Valley depend on many geological, hydrological, climate and human components. To best represent the dynamics of groundwater depth level we emulate from the physical model Fine Grid California Central Valley Groundwater-Surface Water Simulation Model (C2VSIM-FG version 1.01) \citep{dwr_c2vsimfg_2021} using a response function. C2VSIM-FG has a finite element grid of more than 35,000 elements for California’s Central Valley California, and each element is able to link land surface, surface water and ground-water. The model detailed historical data (i.e., cropland use, crop water demand, surface water diversions, precipitation, soil moisture) to inform the simulations process. C2VSIM-FG simulates the period from 1973 to 2015 at a monthly time step. Water budgets are generated for each element in the grid including groundwater pumping and groundwater depth and can be post-processed to create water budgets for defined boundaries (group of elements). We use the water budget generated for the Semitropic Water Storage District's boundary as represented on the finite element grid. 

From C2VSIM-FG outputs we used the weighted-average groundwater depth level to agricultural pumping. Since the economic model simulates farmers’ decisions at a yearly time step, we use the groundwater depth change from the beginning of the water year (October) to the end of the water year and irrigation season (September), and the total agricultural groundwater pumping in a water year to calibrate the response function. Figure \ref{fig:3} shows the simulated groundwater depth and agricultural pumping from C2VSIM-FG at the end of each water year from 1972-2016. 

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.5\textwidth]{c2vsim_semitropic.png}
    \caption{Groundwater depth and agricultural groundwater pumping from simulation outputs of C2VSIM-FG \citep{dwr_c2vsimfg_2021}}
    \label{fig:3}
\end{figure}

The groundwater depth change response function was calibrated using a Bayesian linear regression (SM C). The response function predicts the groundwater depth change each year as a function of total agricultural pumping. As shown by Equation \ref{eq:9}, the ground water depth level at the beginning of the water year t ($GWD_{t}$) is calculated as the sum of the groundwater depth level at the beginning of the prior water year t-1 ($GW_{t-1}$)  and the median of the predictive posterior distribution for groundwater depth change ($\overline{\Delta GWD}_{t-1}$) estimated at the end of the water year t-1. By embedding this function into the economic model defining the pumping cost as a function of the groundwater depth (SM 5) enables our ability to directly model the feed-back between food production and groundwater levels. 

\begin{equation}
\label{eq:9}
GWD_{t} = GWD_{t-1} + \overline{\Delta GWD}_{t-1}
\end{equation}

\subsection{Stochastic time series}\label{sct:2.2}

To run the model dynamically, we build Monte Carlo time series for economic and hydrologic conditions that are used to force the HEM. Each time series starts at $t_{1}=2016$. In our analysis. we included simulated surface water supplies to the irrigation district (Figure S2 in SM 3) from the California’s Food-Energy-Water System simulation model (CALFEWS) \citep{zeff_californias_2021}. These were simulated with down-scaled data from seven of the ten Global Circulation Models (GCMs) suggested by \citet{pierce_climate_2018} (CCSM4, MIROC5, CanESM2, CNRM-CM5, GFDL-CM3, HadGEM2-CC and HadGEM2-ES), and using the Representative Concentration Pathway (RCP) 4.5 (moderate scenario) and 8.5 (high emissions scenario). 

Additionally, we model uncertainties for the economic variables and calibration parameters of the economic model, summarized in Table \ref{tbl:1}. Crop prices $p_{i,t}$ were randomly sampled using the historical data from 1980 to 2020 \citep{usda_national_2020} and the price of electricity ($\omega_{E,t}$) was sampled from the historical (2008-2021) reported by the Pacific Gas and Electricity Company (PG\&E) for small and large agricultural users. The price of surface water ($\omega_{SW,t}$) is correlated to the surface water deliveries depending on the water-year type(wet or dry) and randomly sampled from reported rates in the district using surface for different water supply conditions. All prices were adjusted for inflation using the consumer price index based on the year 2016. Finally a sample from the posterior distribution of the calibration parameters $\theta_{i}$ is sampled.

\begin{table}[width=.9\linewidth,cols=4,pos=h]
\caption{Data Sources for Monte Carlo Time Series}\label{tbl:1}
\begin{tabular*}{\tblwidth}{@{} LLLL@{}} 
\toprule
Variable & Symbol & Units & Source\\ 
\midrule
Crop prices & $p_{i}$ & \$/ton & \citet{usda_national_2020} \\
Price of electricity & $\omega_{E,t}$ & $\$/Kwh$ & \citet{pge_pacific_2021} \\
Price of surface water & $\omega_{SW,t}$ & $\$/m^3$ & SWSD reports \\
Surface water supply & $b_{SW,t}$ & $m^3$ & \citet{zeff_californias_2021} \\
Calibration parameters & $\theta_i$ & - & PMP Calibration \\
\bottomrule
\end{tabular*}
\end{table}

\section{Dynamic and Adaptive Decisions}\label{sct:dps}

Searching for adaptive groundwater management policies using DPS consists of finding parameters of the control policy function that yield the optimal control alternatives that compose the trade-offs between the groundwater sustainability and economic objectives. Different parametric functions can be used to model control policies, including linear, polynomial, neural networks, decision trees and radial basis functions \citep{giuliani_universal_2014,giuliani_state---art_2021}. In this study, we used cubic radial basis functions (RBFs) to accommodate the complexity of the dynamic GSA level decisions that are coordinated and responsive to  surface water supply conditions, crop-land decisions, and the groundwater depth observed at the beginning of a water year. The four decisions that comprise the control policy are: the groundwater pumping fee (GWF), total land restriction (TL), perennial cropland restriction (PL) and groundwater pumping restriction (GWP). 


\subsection{Direct Policy Search}

Dynamic land and groundwater management decisions made at every yearly step $t$ are represented by the vector $u_{t}^D$ where $D \in \{GWP,TL,PL,GWF\}$ represent the four possible decisions. The control policy in Equation 10 equates to the outputs of a policy $P^D$ which is a mathematical function with two vector inputs: the structural parameters of the RBFs ($\psi^D$) and system-state information vector ($I_{t'}$). The state information variables in $I_{t'}$ represent key components of the food-water system are observed in the current water year $t$ or previous water year $t-1$. 

\begin{align}
u_{t}^D = P^{D}(I_{t'}|\psi^{D})
\end{align}

In direct policy search, the use of RBFs has been shown to be an efficient way to represent complex sequential decisions. Recent applications include lake pollution control \citep{quinn_direct_2017}, reservoir operations \citep{giuliani_universal_2014, zatarain_salazar_balancing_2017,giuliani_state---art_2021}, sea-level rise protection \citep{garner_using_2018}, flood risk management \citep{wang_incorporating_2023}, and financial risk management in water-energy systems \citep{gupta_can_2020,hamilton_stream_2022}. For this study, we define the control policy function $P^D$ as a set of cubic radial basis functions given by Equation \ref{eq:11}.

\begin{align}\label{eq:11}
u_{t}^D = \phi^{D}\left(\sum_{m=1}^M w_{m}^D \sum_{j=1}^J \left\lvert\dfrac{[I_{t'}]_{j}-c_{j,m}}{r_{j,m}}\right\rvert^{3}\right)
\end{align}

In Equation 11 $\phi^{D}$ is an outer function, $w_{m}^D$ is the weight of M cubic radial basis functions. The weights can have values $ 0 \leq w_{m} \leq 1$ and are subject to $\sum_{m=1}^M m_{m}^D= 1$. The four decisions in the control policy share the same RBFs structure; hence the information vector $I_{t'}$ is shared for all decisions. Additionally, $c_{j,m} \in [-1,1]$ and $r_{j,m} \in (0,1]$ are the center and radius respectively shared by all the RBFs. $I_{t'}$ in Equation \ref{eq:12} is a vector with system state variables that inform the policies, where $\overline{GWD}_{t}$ is the normalized level to groundwater at the beginning of the year, $\overline{PCL}_{t-1}$ is the normalized area devoted for perennial crops production in the year $t-1$. $\overline{b}_{SW,t}$ is the normalized surface water available in year $t$. Normalization was performed using $k^{GWD}$, $k^{TL}$, $k^{SW}$ to obtain $\overline{GWD}_{t}$, $\overline{PCL}_{t-1}$, $\overline{b}_{SW,t}$ respectively summarized in Table \ref{tbl:2}.

\begin{align}\label{eq:12}
I_{t'} = [\overline{GWD}_{t},\overline{PCL}_{t-1},\overline{b}_{SW,t}]
\end{align}

\begin{table}[width=.9\linewidth,cols=4,pos=h]
\caption{Normalization factors used in the control policy}\label{tbl:2}
\begin{tabular*}{\textwidth}{@{} LLLL@{}} 
\toprule
Variable & Symbol & Units & Value \\ 
\midrule
Normalization for cropland  & $k^{TL}$ & $Kha$ & 62\\
Normalization for groundwater pumping & $k^{GW}$ & $M m^3$ & 732 \\
Normalization groundwater depth  & $k^{GWD}$ & $m$ & 198 \\
Normalization for pumping fee   & $k^{GWF}$ & \$/$m^3$ & 0.5 \\
Normalization surface water  & $k^{SW}$ & $M m^3$ & 208 \\
\bottomrule
\end{tabular*}
\end{table}


The function $\phi^{D}$ in Equation \ref{eq:11} can consist on two functions, a scaling function $\phi^{D,N}$ and constraint function $\phi^{D,C}$. $z_{t}$ in Equation \ref{eq:13} is the argument to the $\phi^{D}$, where $\phi^{D,N}$ is used to first constraint $z_{t}$ values to lie between 0 and 1 and later scale them to the specific units of each irrigation management policy using the normalization factors in Table \ref{tbl:2}. $\phi^{D,C}$ is used to constraint the values of the candidate policy actions to be realistic considering other  water balance and land constraints.

\begin{align} \label{eq:13}
u^{D}_t = \phi^{D,C}(\phi^{D,N}(z_{t}))
\end{align}

For the groundwater pumping restriction policy ($u^{GWP}_t$), Equation \ref{eq:14} scales the groundwater that farmers will have available to pump between zero and the pumping capacity of the district $k^{GWP}$ (maximum observed pumping). Equation \ref{eq:15} constraints the groundwater pumping to be at least the difference between the water demand by perennial crops of the year $t-1$ and the surface water available in the year $t$. 

\begin{align}\label{eq:14}
z'_{t}=\phi^{GWP,N}(z_{t}) = k^{GWP}max(min(z_{t},1),0) 
\end{align}

\begin{align}\label{eq:15}
u^{GWP}_t = \phi^{GWP,C}(z'_{t})= max(z'_{t},\underset{i \in PCL}{\sum} x_{i,water_{t\mh1}} - \; b_{SW,t})
\end{align}

In Equation \ref{eq:16}, where the scaling function ($\phi^{TL,N}$) results in the total land available that farmers can produce in the district for the year t and can have values between zero and the total land in the district $k^{TL}$ (maximum observed produced land). Additionally, Equation \ref{eq:17} constraints the total land decision to be at least the land used by perennial crops in the the year $t-1$.

\begin{align}\label{eq:16}
z'_{t} = \phi^{TL,N}(z_{t}) = k^{TL}max(min(z_{t},1),0)
\end{align}

\begin{align}\label{eq:17}
u^{TL}_t = \phi^{TL,C}(z'_{t})= max(z'_{t},\underset{i \in PC}{\sum} x_{i,land_{t\mh1}})
\end{align}

Equation \ref{eq:18} governs actions associated with perennial crops planting restriction ($u^{PL}_t$), where $\phi^{PL,N}$ results in the total land that can be allocated to perennial crops production with value between zero and the total land available in the district ($k^{TL}$). In Equation \ref{eq:19}, $\phi^{PL,C}$ constraints the available land for perennial crops to be at least 95\% of the previous year perennial crops land, and it limits the expansion of perennial crops to no more than 5\% relative to the previous year $t-1$. These restrictions are applied to ensure that solutions of the perennial crop acreage control policy are realistic to what has been observed the region.

\begin{align}\label{eq:18}
z'_{t} = \phi^{PL,N}(z_{t}) = k^{TL}max(min(z_{t},1),0)
\end{align}

\begin{align}\label{eq:19}
u^{PL}_t = \phi^{PL,C}(z'_{t})= \begin{cases}
      \underset{i\in{PC}}{\sum} x_{i,land_{t\mh1}}*1.05,  \text{\; if \, $z'_{t}$  $>$ $\underset{i\in PC}{\sum}x_{i,land_{t\mh1}}*1.05$}\\
       \underset{i\in PC}{\sum} x_{i,land_{t\mh1}}*0.95, \text{\; elif \, $z'_{t}$  $<$ $\underset{i\in PC}{\sum}x_{i,land_{t\mh1}}*0.95$}\\
      z'_{t}, \text{\; $otherwise$}
\end{cases}     
\end{align}

Finally for the pumping fee control action ($u^{GWF}_t$), the function $\phi^{GWF}$ in Equation \ref{eq:20}, scales the groundwater pumping fee that can have values between [0,$k^{GWF}$]. $k^{GWF}$ is set to be $\$0.5/m^3$, hence the upper boundary of the pumping fee is 0.5 USD per cubic meter. This fee sums to the groundwater pumping cost in the objective function of the economic model (Equation 1).

\begin{align}\label{eq:20}
u^{GWF}_t = \phi^{GWF,N}(z_{t}) = k^{GWF}max(min(z_{t},1),0)
\end{align}

The dynamic control policy is represented by the set of Equations 11 to 20, where the vector of structural parameters $\psi = [w^{D},c,r]$ of the RBFs is optimized. Since the information vector $I_{t'}$ of size $J$ is shared across decisions in $M$ number of RBF's the vectors of centers (c) and radii (r) are equal to $c=[c_{0,0},...,c_{J,M}]$ and $r=[r_{0,0},...,r_{J,M}]$.

\clearpage

\subsection{Bi-level Optimization Problem}\label{sct:3.2}

A core contribution of this study is the bi-level optimization framework illustrated in Figure \ref{fig:4}. The Borg MOEA \citep{hadka_borg_2013,gupta_can_2020} is used to optimize the vector of structural parameters in the RBFs ($\Psi$). Each set of structural parameters define a control policy (Section \ref{sct:dps}) or set of annual groundwater management decisions ($u^{D}$) that are assessed using the HEM (Section \ref{sct:hem}) across N sampled Monte Carlo times series of T years (Section \ref{sct:2.2}). Within its evaluations, the HEM then finds optimal land and water allocations for the first five years of each time series. At year t=5, the HEM initiates the implementation of the DPS-based management decisions and the evaluation of the overall evaluation of the performance objectives. This framework provides a multi-scale abstraction of dynamic and adaptive flexible groundwater management that has direct relevance to addressing the sustainability challenges discussed in Section \ref{sct:1}. The bi-level optimization clarifies the performance trade-offs across the five objectives that represent the groundwater sustainability and economic goals of the GSA. 

\begin{figure}[pos=hbt!]
    \includegraphics[width=0.9\textwidth,center]{Diagram2}
    \caption{Bi-level optimization problem schematic adapted from \citet{hamilton_stream_2022}. Rectangles represent the modules that contain optimization and simulation models (squares) and inputs/outputs (diamonds). Dashed arrows depict the Borg MOEA feed-back process where the values of objectives and constraint are from performance metrics of HEM result of an implemented control policy.}
    \label{fig:4}
\end{figure}

The first level optimization focuses on the multi-objective evolutionary search to identify the trade-offs across the five performance objectives where the decision variables are the control policy parameters of the RBFs in the vector $\Psi$, used to parameterize the control policy. 

\begin{align}
\underset{\Psi}{argmin} = (-O_{avgrev}(\Psi),O_{avgdepth}(\Psi),-O_{worstrev}(\Psi),O_{worstdepth\Delta}(\Psi),-O_{depthrel}(\Psi))
\end{align}

The first objective $(O_{avgrev})$ is to maximize the average total revenues  from the average total net revenue of N ensemble realizations with T years. This objective represents the economic objective of farmers of revenue maximization. A lower boundary constraint for this objective is defined to achieve at least an average total revenue greater or equal than \$11 billion. This restriction constrains the algorithms from finding unrealistic policies far from farmers preferences. 

\begin{align}
O_{avgrev} = \frac{1}{N}\sum_{n=1}^N(\sum_{t=5}^T \pi_{n,t})
\end{align}


\begin{align}
O_{avgrev} \geq 11,000
\end{align}

The second objective is the minimization of the average groundwater depth in meters bellow surface (m bls). The average groundwater depth is calculated over the years of management implementation (T-5) for each Monte Carlo realization, and then the average of these are taken over the N sampled Monte Carlo realizations. 

\begin{align}
O_{avgdepth} = \frac{1}{N}\sum_{n=1}^N(\frac{1}{T-5}\sum_{t=5}^T GWD_{n,t})
\end{align}

The third objective is to maximize the 5th percentile of the minimum profits attained across the Monte Carlo samples. This metric represents a \textit{max-min} objective formulation that is used to inform decision makers about the worst case 5th percentile of profits achieved in a given year. Even though there are economic factors included in the stochastic ensemble that can be drivers of low economic revenues, management decisions can be the main factors driving poor profits particularly during dry years, as shown by \citet{rodriguez-flores_global_2022}. 

\begin{align}
O_{worstrev} = Q5_{N} \bigg[\underset{t\in(5,...,T)}{min}[\pi_{n,t}]\bigg]
\end{align}

The fourth objective is to minimize the 95th percentile of maximum groundwater depths change (m bls) attained across the Monte Carlo samples. This objective represents a \textit{min-max} objective formulation focused on identifying the outcomes with significant increases in groundwater depth. The maximum groundwater depth level change is evaluated over each annual management implementation period and the Q95 operator takes the 95th percentile over all of the sampled Monte Carlo  realizations. 

\begin{align}
O_{worstdepth\Delta} = Q95_{N} \bigg[\underset{t\in(5,...,T)}{max}[\overline{\Delta GWD}_{t}]\bigg]
\end{align}

As explained in Section \ref{sct:1}, groundwater management allow groundwater depth fluctuate in the marginal of operational flexibility. During dry years the groundwater depth can go above the groundwater level requirement but not beyond the minimum threshold with the expectation that in wet years it will recover. Thus, the fifth objective is to maximize the average fraction of years (reliability) that the groundwater depth is at the level requirement ($GWD^{SGMA}$) or bellow. For illustration purposes we used the 2015 groundwater level from C2VSim-FG as a measurable objective as it was the deepest year in the  2012-2016 drought \citep{lund_lessons_2018}. Additionally, we included a constraint (Equation \ref{eq:28}) that the reliability must be at least 20\% (i.e., one of every five years). 

\begin{align}
O_{depthrel} = \frac{1}{N(T-5)}\sum_{n=1}^N(\sum_{t=5}^T \tau_{n,t})\; where\; \tau_{n,t} = \begin{cases}
      1, \text{\; $GWD_{n,t}$  $\leq$ $GWD^{SGMA}$}\\
      0, \text{\; $GWD_{n,t}$ $>$ $GWD^{SGMA}$}\\
\end{cases}      
\end{align}


\begin{align}\label{eq:28}
O_{depthrel} \geq 0.2
\end{align}

\subsection{Robustness and Scenario Discovery Analysis}\label{sct:3.3}

The bi-level multi-objective optimization problem presented in the prior section provides a direct means for understanding the management trade-offs for the SWSD GSA through analysis of high quality representations of the resulting Pareto front. Solutions in the Pareto front are each distinct control policies that prioritize a subset of objectives. Stakeholders can then choose acceptable policies based on their preferences. However, it is important that these policies can perform well in alternative states of the world beyond those used in the optimization that can change the decision makers' preferences from their initial expected trade-offs performance \citep{herman_how_2015}. Thus, we reevaluate these policies across a broader sampling of deep uncertainties (Section \ref{sct:2.2}) to quantify their robustness. Different metrics can be used to measure the robustness of each control policy which inherently represents a variety of farmers’ and water managers’ acceptability thresholds and their perception of risk \citep{mcphail_robustness_2018}. 

Using all the policies from the Pareto approximate set, these are assessed across  N=1,000 sampled Monte Carlo resolutions with T=30 years. Each time series has a set of surface water supplies, crop prices, electricity price, surface water price and calibration parameters. For this study, we selected the domain criterion satisficing metric \citep{schneller_decision_1983} that quantifies the fraction of scenarios (rate of success) that achieve a minimum performance threshold, from a larger set of states of the world different than the ones used in the EMODPS search. To illustrate this process, we defined an example of performance criteria and rates of success, shown in Table \ref{tbl:3}, all of which a control policy must achieve in N resolutions and 25 years of management implementation to be considered robust. These performance criteria include a minimum total revenue and a groundwater depth requirement that the flexible management is expected to reach during wet years, as shown in Figure \ref{fig:1}. Additionally, a minimum perennial trees land in a year is defined to be at least 50\% from the baseline (33,161 ha). 

\begin{table}[width=.9\linewidth,cols=4,pos=h]
\caption{Performance Criteria for selection of robust policies}\label{tbl:3}
\begin{tabular*}{\linewidth}{@{} LLLL@{}}
\toprule
 Criteria  & Threshold & Units & Rate of Success \\ 
\midrule
Minimum Total Revenue   & > 12,500 & M USD & $\geq$ 80\% \\
Groundwater Depth Requirement & < 92 & m bls & $\geq$ 20\%  \\
Minimum Perennial Trees Land  & > 40,971 & hectares & $\geq$ 90\%  \\
\bottomrule
\end{tabular*}
\end{table}

In order to identify the vulnerabilities of solutions that cause failure to meet the robust performance criteria or poor performance, we use scenario discovery commonly perform in robust decision making \citep{kasprzyk_many_2013,lempert_identifying_2010}. This analysis is particularly important in systems with non-linearities where can be hard to map inputs - objective performance given the uncertainties in the system that change every year. For this study, we use the Patient Rule Induction Method (PRIM) \citep{friedman_bump_1999,kwa}, a statistical learning algorithm. This method provides factor mapping and visualization to identify uncertain input ranges that result in an outcome space of particular interest. PRIM algorithm calculates scenario boxes that describe values between two inputs that cause a policy to meet the robust criteria (Table \ref{tbl:3}), using the results from SOWs used in the robustness analysis. Additionally, we can identify the vulnerabilities of the policy ranking the most relevant uncertain inputs that impacted a policy to fail meeting the robustness criteria or a single objective. Using the exploratory modeling and analysis workbench \citep{kwakkel_exploratory_2017} we perform a feature scoring using extra trees algorithm \citep{geurts_extremely_2006}. 

\section{Computational Experiment}

The search for optimal RBFs parameters in EMODPS is a non-convex problem \citep{giuliani_curses_2016} solved in this study using stochastic multi-objective evolutionary search. MOEAs are a popular tool for multi-objective optimization that iteratively improve a population of possible solutions  until the population reaches a high quality representation of the Pareto front composed of the non-dominated solutions \citep{coello_evolutionary_2007}.  For this study we use the Borg MOEA \citep{hadka_borg_2013}, a self-adaptive algorithm that employs probabilistic operators as $\epsilon$-dominance, adaptive population sizing and time continuation through $\epsilon$-progress. The Borg MOEA has shown have better time efficiency, scalability, and controllability, as well as less sensitivity to its parameterizations compared to other MOEA algorithms with many applications in the literature \citep{reed_evolutionary_2013,gupta_can_2020,zatarain_salazar_balancing_2017,seyedashraf_assisting_2023,al-jawad_reservoir_2017}. Since the Borg MOEA is a stochastic algorithm, we estimate Pareto-front solutions using ten different random seeds (i.e., random initializations of the population) using the master-worker parallel configuration of Borg \citep{hadka_large-scale_2015}. All the Borg MOEA parameters are set to the default values \citep{hadka_borg_2013} and $\epsilon$-values (resolution) for each objective are summarized in SM Table S2. The quality for each random seed is evaluated through its hypervolume \citep{hadka_diagnostic_2012} to prove that the search is reliable and effective given the number of function evaluations, shown in the Figure S10 of the SM.

The economic model (Section \ref{sct:hem}) was formulated using the Python package Pyomo \citep{hart_pyomo_2011} and solved using the non-linear programming solver IPOPT \citep{wachter_implementation_2006}. The decision variables in the economic model are the allocation of land and water (surface water and groundwater) to seventeen crop groups resulting in a total of 68 decision variables for each time step t. Additionally at each time step the groundwater depth change was estimated using the posterior predictive distribution of the parameters in the calibrated groundwater depth response function.

We performed the bi-level optimization process for an ensemble of N = 100 Monte Carlo realizations and T = 30 years for 50,000 candidate policy trials (function evaluations). One limitation of the bi-level optimization is the high computational demand that limited the number of sampled Monte Carlo resolutions and function evaluations, however as shown the random seeds hypervolume performance they converged around half of the 50,000 evaluations (SM ). A structure of M=4 RBFs (Equation \ref{eq:11}) was selected given its good performance, resulting in 40 decision variables in the vector $\Psi$ to be optimized with Borg MOEA. The selected Pareto-set with the highest hypervolume was later validated by re-evaluating the solutions on a larger sampled set of independent Monte Carlo samples of size N = 1,000 to verify that reference set is stable as shown by \citep{gupta_can_2020}. Results from the validation are shown in Figure S in the SM. To inform the robustness analysis and scenario discovery we used a Monte Carlo ensemble of N = 1,000 expanding the assumed range of crop prices, surface water price and electricity price by \%20 relative to the historical. All the computational experiments were performed using the MERCED cluster of the University of California Merced. 

\section{Results and Discussion}

Figure \ref{fig:5} shows Pareto-approximate reference set that spans different trade-offs among the five objectives in the problem. In the figure each triangle represents the objective values associated with selected control policies ($\Psi$ values). The size of the triangle depicts the 95th percentile of the maximum groundwater depth changes in a year, and the color gradient depicts the 5th percentile of the minimum revenue in a year. The star represents a hypothetical the ideal solution that would allow for the shortest average groundwater depth while providing the highest possible revenue across the sustainable management implementation period. Characteristic behavior emerges particularly as average groundwater depth decreases, economic revenues (and minimum revenues) decrease as well. Average groundwater depth decreases also correspond to an increase in the reliability to meet the groundwater level requirement. However, for some policies to attain one hundred percent reliability, they limit groundwater pumping, including during dry years, which results in lower total and minimum revenues. These solutions represent are unlikely to be applied in the SWSD, since recovering the groundwater depth to be bellow the level requirement in all years is not the objective but rather a flexible management, explained in Section \ref{sct:1}. Maximum groundwater depth change (size of the triangle) reach values as the maximum depth change observed in the historical record (Figure S7 in SM), highlighting the capacity of the policies to avoid larger depth changes even in drier future conditions. However, as maximum depth changes reduce the Pareto-front shifts downwards resulting in lower average revenues. 

\begin{figure}[htb!]
    \includegraphics[width=0.7\textwidth,center]{./figs/3d_plot.png}
    \caption{Pareto approximate set from the EMODPS experiment} \label{fig:5}
\end{figure}

To assess the adaptive capacity of the resulting policies to uncertain surface water supplies and economic conditions, we selected three policies that achieve different trade-offs in the Pareto-reference set Figure \ref{fig:5}. The selected policies for further analysis are the policy with the largest average total revenue (MaxRev), the policy with lowest average groundwater depth (MinDepth), and a policy with \%60 average reliability of meeting the groundwater depth requirement (\%60Rel). The objectives performance from the selected policies is summarized in Table \ref{tbl:4}. These solutions contain four different DPS-based irrigation management policies (Section \ref{sct:dps}) that would adapt under system state conditions. We asses their performance using the driest, wettest and largest standard deviation from the Monte Carlo sampled SOWs used in the evolutionary search (Section \ref{sct:2.2}). 
We allow PMP to run without any DPS control policy for the first five years followed by a 25 years period of DPS control policy implementation.  

\begin{table}[width=.8\linewidth,cols=6,pos=htb!]
\caption{Performance of the selected policies shown in Figure 5}\label{tbl:4}
\begin{tabular*}{\tblwidth}{@{} LLLLLL@{}}
 \toprule
 Solution & O_{avgrev} & O_{avgdepth} & O_{worstrev} & O_{worstdepth\Delta} & O_{rel} \\ 
 \midrule
MaxRev &  13,788 & 100 &  283 & 6.4 & 20\% \\
60\%Rel &  13,222 & 91 & 277 & 5.8 & 60\% \\
MinDepth &  11,141 & 66 & 216 & 5.1 & 100\% \\
\bottomrule
\end{tabular*}
\end{table}

Figure \ref{fig:6} shows the evolution of dynamic management decisions and their performance in the SWSD's food-water system using the SOW with the largest standard deviation on surface water deliveries 
(CANESM2 8.5). This surface water supply scenario captures interesting regional dynamics with interspersed dry and wet periods. In the initial 5 years before the management policies are implemented the perennial cropland expands with a reliance on groundwater pumping due to reduced surface water (a), and results in increasing the groundwater depth (g). Starting with implementation (after year 5). Figure \ref{fig:6} panels (b)-(e) shows how the irrigation management decisions evolve, showing the dynamic and adaptive performance of the control policy. The total land planting restriction (e), is the only decision that shows a non-implementation behavior for the selected policies, given that other decisions regulate land use via groundwater pumping (f) that result in a better performance of the system. In general the 60\%Rel and the MaxRev solutions show similar policy control behavior, but with different magnitude of restrictions and ground water pumping fee policies. Figure \ref{fig:6} panel (b) demonstrates that all three solutions implement groundwater restrictions during the initial stages of management. The solution with the lowest average groundwater depth (MinDepth) implements a continuous restriction that only relaxes during wet years. Policies show a declining land allocation to perennial crops from the initial area (i). Given the flexibility that annual crops provide to the water budget, the three solutions decrease annual crops acreage at early stages of implementation with expansion during wet periods, shown in panel (j). These results confirm that sustainable groundwater management benefits from reducing the hard water demand imposed by perennial tree crops which has also been suggested in other studies \citep{qin_flexibility_2019,mall_water_2019} and an overall cropland reduction \citep{hanak_water_2019}. 

\begin{figure}[htb!]
    \includegraphics[width=0.8\textwidth,center]{./figs/selected_highsd_performance.png}
    \caption{Performance of the dynamic and adaptive irrigation management policies and hydro-economic model performance over a 30 year realization period with 25 five years implementation of irrigation management decisions. Panel (a) shows the surface water deliveries. Panels (b)-(e) show the dynamic decisions in the control policy. Panels (f)-(j) show the performance of the food-water system. The orange line in Panel (g) depicts the groundwater depth requirement used in the experiment.} \label{fig:6}
\end{figure}

During dry years, control policies allow pumping to offset lack of surface water, however such policies do not reach the region’s pumping capacity and limit pumping to be extracted at a threshold (460 $M m^3$ for the MaxRev solution) as shown in Figure \ref{fig:6}, which can be considered a safe yield as suggested by \citet{miro_framework_2019} and \citet{macewan_hydroeconomic_2017}. Figure \ref{fig:6} panel (f) shows that at as perennial tree crops have been reduced by the perennial planting decision, the control policy regulates most of the planting via a groundwater pumping fee (c). Control policies establish a pumping fee for all the implementation period, however use of a pumping fee peaks during wet years to limit the expansion of annual crops and maximize groundwater recovery. Implementing a pumping fee can improve the irrigation efficiency and control the expansion of cropland during wet and dry years as suggested by \citet{stone_economic_2022}, \citet{graveline_combining_2020}, and \citet{khan_effect_2019}. The examined policy solutions suggest a pumping fee between $\$0.1/m^{3}$ and $\$0.2/m^{3}$ that increases up to $\$0.5/m^{3}$ during wet years that allows groundwater recovery.

Selecting different solutions along the Pareto approximate set allows assessment of their performance and provides insight of potential trade-offs of implementing management decisions. As shown in Figure 6 panel (g) implementing the MinDepth control policy results in a constant recovery of the groundwater depth, thus a larger groundwater depth requirement reliability. However, solutions MaxRev and \%60Rel achieved the measurable objective in wet years and prescribe higher cropland than the MinDepth solution. One key insight is that control policies stopped the decline in groundwater depth observed in the historical record (Figure \ref{fig:2}), allowing the groundwater depth to reach a maximum depth level where is feasible to recoverand meet the groundwater depth requirement. Depending on the control policy, the largest groundwater depth and the number of years that achieve the measurable objective change. This suggests GSAs achieve the flexible management that maintain the groundwater depth at a level where its capable to achieve the groundwater depth requirement post-drought. However, policies need to be flexible enough to allow groundwater depth to recover during wet years contrary to what has been observed during the past decades \citep{liu_groundwater_2022,alam_post-drought_2021}. Evolution of irrigation management policies and system performance in wet and dry SOWs are shown in SM Figure S.

\subsection{Robustness and Scenario Discovery Analysis}

As explained in Section \ref{sct:3.3} solutions in the Pareto-approximate set are re-evaluated in 1,000 alternative SOWs and we calculate their robustness as percent of SOWs that the three preference criteria and preference success rate are met, summarized in Table \ref{tbl:3}. These result in twenty four robust solutions out four hundred twenty six in the reference Pareto approximate set shown in Figure \ref{fig:7}. We selected two robust policies from the robust solutions set for further exploration, the solution with lowest average minimum depth (RobustMinDepth) and the solution the largest average total revenues (RobustMinDepth) from the re-evaluation across 1,000 alternative SOWs. 

The performance of these robust policies is assessed using the using the same surface water supply scenarios as in the previous section, shown in Figures S - S in SM. Compared to the policies selected previously (Figure \ref{fig:6}), the selected robust policies RobustMaxRev and RobustMinDepth are able to meet not only the performance criteria but also a more flexible groundwater depth, shown in panel (g) from Figures \ref{fig:6} and \ref{fig:8}. This behavior results in higher revenues while meeting the groundwater depth requirement in wet periods and its reliability. Additionally, robust policies show this behaviour in the Wet and Dry scenario, demonstrating their reliability to meet the performance preferences.

\begin{figure}[htb!]
    \includegraphics[width=0.8\textwidth,center]{./figs/selected_robust.png}
    \caption{Policies from Pareto approximate set shown Figure \ref{fig:5}. Robust policies are in red and selected robust policies for further analysis in blue. Policies in the Pareto approximate set that did not meet the satisfying criteria are in grey.} \label{fig:7}
\end{figure} 

\begin{figure}[htb!]
    \includegraphics[width=0.8\textwidth,center]{./figs/robust_highsd_performance.png}
    \caption{Performance of the selected dynamic and adaptive robust policies and hydro-economic model performance over a 30 year realization period with 25 five years implementation of irrigation management decisions. Panel (a) shows the surface water deliveries. Panels (b)-(e) show the dynamic decisions in the control policy. Panels (f)-(j) show the performance of the food-water system. The orange line in Panel (g) depicts the groundwater depth requirement used in the experiment.} \label{fig:8}
\end{figure}

\clearpage

To continue the exploration of what conditions are not allowing robust policies to meet the preference criteria we use the 

\begin{figure}[htb!]
    \includegraphics[width=0.7\textwidth,center]{./figs/prim_robust_mindepth.png}
    \caption{Combination of parameters that result in } \label{fig:9}
\end{figure}

\clearpage
\section{Discussion}

This study contributes a novel assessment of the suitability of evolutionary multi-objective direct policy search to discover adaptive groundwater management strategies with a focus on meeting SGMA sustainable groundwater guidelines. We assess the ability of EMODPS to help operationalize groundwater sustainable management that targets the yearly decisions of water managers and farmers within both sectors of the complex food-water system. Resulting policies were adaptive to changes in system conditions, showing flexibility between dry and wet years, that maximize total average revenue and lowest revenue in a year and minimize average groundwater depth and maximum groundwater depth in a year. This paper contributes to the body of literature that evaluates optimal land and water use controls and economic instruments (e.g. pumping fees) to achieve groundwater sustainability in agriculture. To the authors’ knowledge, this is the first paper to search for dynamic adaptive policies in food-water systems.  

This study was applied to the Semitropic Water Storage District GSA in Kern County, California, which represents a broad set of water agencies in overdrafted groundwater basins subject to groundwater sustainability legislation. Results from this study provide insight into the ongoing development and implementation of groundwater management policies which can be scaled up to other basins agencies in the state. Overall, we find that:  

\begin{enumerate}
    \item   Reducing the proportion of perennial trees improves the adaptation capacity by increasing water demand flexibility.  
    \item  Annual crops can work as a buffer to support cropland increases during wet years and reductions during dry years.
    \item  Additionally, in early groundwater management implementation, a groundwater restriction is needed to bring the groundwater depth to a level where GSAs can feasibly manage groundwater to achieve measurable sustainable groundwater depth.
    \item The minimum threshold defined in GSPs should operate by the level where the GSAs can feasibly recover the groundwater depth and meet the groundwater depth requirement.
    \item  A pumping fee policy shows promise in coordinating surface and groundwater use and incentivize sustainable pumping. 
\end{enumerate}

This study used the sustainable management criteria defined by the California’s 2014 Sustainable Groundwater Management Act to assess the policies found by the EMODPS. Such policies allow a margin of operational flexibility where the groundwater depth can reach a sustainable objective, defined in this study, allowing an increase in groundwater depth during dry years but where is still feasible its recovery. However, as showed in this  study the capacity of a GSA to achieve this management depends on the minimum depth threshold and the capacity to decrease the irrigation demand in dry years and maximize recharge during wet years. The methodology shown in this paper can be applied to other agricultural regions in the world where irrigation is the main groundwater user and finding adaptive policies is crucial for groundwater sustainability. 

\subsection{Limitations and Future Work}

Climate change impacts in the region such as impacts on crop yields \citep{blanc_is_2017}) and increase on potential evapotranspiration \citep{mcevoy_projected_2020,vahmani_will_2022} may occur but were not part of the present analysis. Additionally, surface water deliveries used in this study were obtained from the CALFEWS model \citep{zeff_californias_2021} which may have other intrinsic uncertainties not discussed in this study. Also, the groundwater depth response employed does not reflect the complexity of the aquifer dynamics, such as lateral flows from nearby basins, and surface-groundwater interactions beyond agricultural recharge among others. However, the groundwater response approach employed allows us to capture the general trend and response from groundwater pumping and recovery in the district. Crop prices used in the computational experiment were sampled from the historical and may not reflect future conditions, which are difficult to forecast given their variability and dependence on a highly dynamic globalized economy. 

Future studies could consider increase groundwater via managed aquifer recharge \citep{alam_can_2020} and potential participation in water markets \citep{arellano-gonzalez_adaptive_2021,hanak_water_2019} that can potentially increase the water availability and groundwater recovery. The results demonstrate that cropland reduction is a feasible strategy to achieve groundwater sustainability. However, developing cropland repurposing frameworks that can benefit groundwater sustainability, ecosystems and communities could have synergistic positive economic outcomes \citep{biggs_landowner_2022,fernandez-bou_water_2023,espinoza_fallow_2023}. The multiple benefits from repurposing cropland could be included as additional objectives along with objectives that relate to ecosystem services. Future studies should consider expanding the area study to the San Joaquin Valley to demonstrate how multiple GSAs can develop conjunctive water use management strategies. Finally, this study used district-wide performance in its formulation; however nuances within the district due to the diversity of farm scale operations and commodities can exist. Thus, future studies could consider social metrics as equity and water affordability as additional objectives.  

\section*{Acknowledgements}

This work was supported by the California Department of Food and Agriculture grant agreement 21-0557-000-SO, by the Agriculture and Food Research Initiative Competitive Grant number 2021- 69012-35916 from the USDA National Institute of Food and Agriculture, and by the NSF INFEWS program grant number 1639268. José M. Rodríguez-Flores was partially supported by the UC Mexus-CONACYT scholarship. This research was conducted using MERCED cluster (NSF-MRI, \#1429783) at the Cyberinfrastructure and Research Technologies (CIRT) from the University of California Merced. We acknowledge the support from students from the Water Systems Management Lab at UC Merced who supported data collection Spencer A. Cole, Elisa Gonzales and Kimberly Parra. VIC-CropSyst results used to estimate the crop yield elasticity to water were provided by Tina Karimi. Outputs from  C2VSim-FG were provided by Jorge A. Valero Fandiño (UC Merced, Water Systems Management Lab). The views expressed in this work represent those of the authors and do not necessarily reflect the views or policies of the Semitropic WSD , the California Department of Water Resources or the California Department of Food and Agriculture. 

\section*{Data Availability Statement}

To access the Python code used for the computational experiment and  visualization of the results readers can refer to the Github repository: \url{https://github.com/josemrodriguezf/EMODPS_SGMA}.

\printcredits

%%%%%%%%

%% Loading bibliography style file
% \bibliographystyle{model1-num-names}
\bibliographystyle{cas-model2-names}

% Loading bibliography database
\bibliography{Bio}

\end{document}

